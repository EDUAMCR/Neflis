@model Neflis.Models.ViewModels.PerfilViewModel

@{
    ViewData["Title"] = "Editar perfil";
    Layout = "_Layout";
    ViewData["BodyClass"] = "auth-body";
}

<!-- ========================= -->
<!--    CSS INTEGRADO          -->
<!-- ========================= -->
<style>
    /* Avatar grande */
    .perfil-avatar-lg {
        width: 140px;
        height: 140px;
        border-radius: 50%;
        object-fit: cover;
        display: block;
        margin-left: auto;
        margin-right: auto;
        box-shadow: 0 0 12px rgba(0,0,0,0.35);
    }

    /* Avatares pequeños */
    .perfil-avatar-option {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        object-fit: cover;
        cursor: pointer;
        transition: transform .2s ease;
        border: 2px solid transparent;
    }

    .avatar-choice {
        display: inline-block;
        padding: 4px;
        border-radius: 50%;
        transition: 0.2s ease-in-out;
    }

        .avatar-choice:hover {
            transform: scale(1.1);
        }

    .avatar-choice--active {
        border: 2px solid #e50914;
        transform: scale(1.15);
    }

    .avatar-choice input[type="radio"] {
        display: none;
    }
</style>


<div class="auth-shell">
    <div class="auth-wrapper">
        <div class="auth-card" style="max-width:520px;">
            <h2 class="auth-title mb-3 text-center">Editar perfil</h2>

            <form asp-action="EditQuick" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="PerfilId" />

                <!-- Avatar grande -->
                <div class="mb-3 text-center">
                    <img id="avatarPreview"
                         src="@Url.Content(Model.AvatarUrl ?? "/img/avatar_1.jpeg")"
                         alt="Avatar actual"
                         class="perfil-avatar-lg mb-3" />
                    <div class="form-text">
                        Selecciona un nuevo avatar si deseas cambiarlo.
                    </div>
                </div>

                <!-- Opciones de avatar -->
                <div class="d-flex justify-content-center gap-3 mb-4">

                    <label class="avatar-choice @(Model.AvatarUrl == "/img/avatar_1.jpeg" ? "avatar-choice--active" : "")">
                        <input type="radio" name="AvatarUrl" value="/img/avatar_1.jpeg"
                               @(Model.AvatarUrl == "/img/avatar_1.jpeg" ? "checked" : "") />
                        <img src="/img/avatar_1.jpeg" class="perfil-avatar-option" />
                    </label>

                    <label class="avatar-choice @(Model.AvatarUrl == "/img/avatar_2.jpeg" ? "avatar-choice--active" : "")">
                        <input type="radio" name="AvatarUrl" value="/img/avatar_2.jpeg"
                               @(Model.AvatarUrl == "/img/avatar_2.jpeg" ? "checked" : "") />
                        <img src="/img/avatar_2.jpeg" class="perfil-avatar-option" />
                    </label>

                    <label class="avatar-choice @(Model.AvatarUrl == "/img/avatar_3.jpeg" ? "avatar-choice--active" : "")">
                        <input type="radio" name="AvatarUrl" value="/img/avatar_3.jpeg"
                               @(Model.AvatarUrl == "/img/avatar_3.jpeg" ? "checked" : "") />
                        <img src="/img/avatar_3.jpeg" class="perfil-avatar-option" />
                    </label>

                    <label class="avatar-choice @(Model.AvatarUrl == "/img/avatar_4.jpeg" ? "avatar-choice--active" : "")">
                        <input type="radio" name="AvatarUrl" value="/img/avatar_4.jpeg"
                               @(Model.AvatarUrl == "/img/avatar_4.jpeg" ? "checked" : "") />
                        <img src="/img/avatar_4.jpeg" class="perfil-avatar-option" />
                    </label>
                </div>

                <div class="mb-3">
                    <label asp-for="NombrePerfil" class="form-label">Nombre del perfil</label>
                    <input asp-for="NombrePerfil" class="form-control" />
                    <span asp-validation-for="NombrePerfil" class="text-warning small"></span>
                </div>

                <div class="form-check mb-4">
                    <input asp-for="EsInfantil" class="form-check-input" />
                    <label asp-for="EsInfantil" class="form-check-label">Perfil infantil</label>
                </div>

                <button type="submit" class="btn-auth-primary w-100 mb-2">
                    Guardar cambios
                </button>

                <a asp-controller="PerfilSelector"
                   asp-action="Index"
                   class="btn-auth-secondary w-100 text-center">
                    Cancelar
                </a>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Cambiar avatar grande al seleccionar uno pequeño
        document.querySelectorAll('label.avatar-choice input[type="radio"]').forEach(function (radio) {

            radio.addEventListener('change', function () {

                var preview = document.getElementById('avatarPreview');
                preview.src = this.parentElement.querySelector('img').src;

                document.querySelectorAll('label.avatar-choice').forEach(function (lbl) {
                    lbl.classList.remove('avatar-choice--active');
                });

                this.parentElement.classList.add('avatar-choice--active');
            });
        });
    </script>
}
